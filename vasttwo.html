<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
</head>
<body>
<div id="plane">
</div>
<script>
var rootContext = "/vasttwo";
//init
var imgarr= (function() {
	var imgarr = null;
	$.ajax({
		'async': false,
        'global': false,
        'url': "images.json",
        'dataType': "json",
        'success': function (data) {
            json = data;
        }
	});
	return json;
})();
var north = [];
var south = [];
var east = [];
var west = [];

//fill each cardinal array with every image that can move in that direction
for (img in imgarr){
	if (imgarr[img].includes("n")){
		north.push(img);
	};
	if (imgarr[img].includes("s")){
		south.push(img);
	};
	if (imgarr[img].includes("e")){
		east.push(img);
	};
	if (imgarr[img].includes("w")){
		west.push(img);
	};
}

//make a random starting img
var imgIndex = Math.floor(Math.random() * 259);
var imgarrKeys = Object.keys(imgarr);
var startImg = imgarrKeys[imgIndex];
var imgpath = rootContext + '/images/' + startImg + '.png'
//console.log("image path " + imgpath);
$('#plane').css({
	height:"190px",
	width:"320px",
	backgroundRepeat: "no-repeat",
	backgroundSize:"320px 190px"
});
//$('#plane').css("background-image","url(" + imgpath+ ")");
//$('#plane').load(imgpath + ' #plane');
var image = new Image();
image.src = imgpath;
image.onload = function() {
	$('#plane').empty().append(image);
}

var themap = {};
var foo = [startImg]
for (var f in foo){
	themap[foo[f]]={};
}
/*
if (typeof map.startImg["w"] != 'undefined'){
	console.log(map.startImg["w"]);
};
*/

//make buttons
var directions = ["north","south","east","west"];
for (dir in directions){
	var inputElement = document.createElement('input');
	inputElement.type = "button";
	inputElement.value = directions[dir];
	inputElement.id = directions[dir];
	document.body.appendChild(inputElement);
}
//hey buddy here's what you need to work on
//you need to access the value of n:vast
$('#north').click(function(){
	var newTile = loadImg("north"); //array of newTile and oldTile with new neighbor tiles
	if (typeof newTile != "undefined"){ //ok sometimes we'll get back an empty object
		for (var arrIndex in newTile){ //ok, the arrIndex = vast1234, there's two in each newTile, one for the old and one fo rhte new
			var vastArrObj = newTile[arrIndex]; //set an object equal to the value of newTile[vast1234], e.g. "a1235":{}"
			for (var vastNumber in vastArrObj){ //each of these has 1 object like this in there, e.g. "a1235"
				if (typeof themap[vastNumber] == "undefined"){ //again, sometimes will be empty
					themap[vastNumber] = vastArrObj[vastNumber];
				} else {
					var fubar = vastArrObj[vastNumber]; //vastArrObj[a1235] = {"n":"vast1236"}
					var newDirList = Object.assign(themap[vastNumber], fubar); //combine these two dicts into 1 dict
					themap[vastNumber] = newDirList; //assign those new dicts to the map at the key of the tile
				}
			}	
		}
	};
	console.log(themap);
});
$('#south').click(function(){
	var newTile = loadImg("south");
	if (typeof newTile != "undefined"){
		for (var arrIndex in newTile){ //ok, the arrIndex = vast1234, there's two in each newTile, one for the old and one fo rhte new
			var vastArrObj = newTile[arrIndex]; //set an object equal to the value of newTile[vast1234], e.g. "a1235":{}"
			for (var vastNumber in vastArrObj){ //each of these has 1 object like this in there, e.g. "a1235"
				if (typeof themap[vastNumber] == "undefined"){ //again, sometimes will be empty
					themap[vastNumber] = vastArrObj[vastNumber];
				} else {
					var fubar = vastArrObj[vastNumber]; //vastArrObj[a1235] = {"n":"vast1236"}
					var newDirList = Object.assign(themap[vastNumber], fubar); //combine these two dicts into 1 dict
					themap[vastNumber] = newDirList; //assign those new dicts to the map at the key of the tile
				}
			}	
		}
	};
	console.log(themap);
});
$('#east').click(function(){
	var newTile = loadImg("east");
	if (typeof newTile != "undefined"){
		for (var arrIndex in newTile){ //ok, the arrIndex = vast1234, there's two in each newTile, one for the old and one fo rhte new
			var vastArrObj = newTile[arrIndex]; //set an object equal to the value of newTile[vast1234], e.g. "a1235":{}"
			for (var vastNumber in vastArrObj){ //each of these has 1 object like this in there, e.g. "a1235"
				if (typeof themap[vastNumber] == "undefined"){ //again, sometimes will be empty
					themap[vastNumber] = vastArrObj[vastNumber];
				} else {
					var fubar = vastArrObj[vastNumber]; //vastArrObj[a1235] = {"n":"vast1236"}
					var newDirList = Object.assign(themap[vastNumber], fubar); //combine these two dicts into 1 dict
					themap[vastNumber] = newDirList; //assign those new dicts to the map at the key of the tile
				}
			}	
		}
	};
	console.log(themap);
});
$('#west').click(function(){
	var newTile = loadImg("west");
	if (typeof newTile != "undefined"){
		for (var arrIndex in newTile){ //ok, the arrIndex = vast1234, there's two in each newTile, one for the old and one fo rhte new
			var vastArrObj = newTile[arrIndex]; //set an object equal to the value of newTile[vast1234], e.g. "a1235":{}"
			for (var vastNumber in vastArrObj){ //each of these has 1 object like this in there, e.g. "a1235"
				if (typeof themap[vastNumber] == "undefined"){ //again, sometimes will be empty
					themap[vastNumber] = vastArrObj[vastNumber];
				} else {
					var fubar = vastArrObj[vastNumber]; //vastArrObj[a1235] = {"n":"vast1236"}
					var newDirList = Object.assign(themap[vastNumber], fubar); //combine these two dicts into 1 dict
					themap[vastNumber] = newDirList; //assign those new dicts to the map at the key of the tile
				}
			}	
		}
	};
	console.log(themap);
});




//call this function when the move buttons are pushed
//all cardinal directions are referred to relative to the new image, so clicking "north" means that's the direction we are coming from
function loadImg(directionFrom){
	var currentImg = $('#plane').children("img").attr('src'); //grip source of current img
	var myRe = /vast\d{1,}/; //make a regex pattern to grip just the vast123 part
	var result = myRe.exec(currentImg); //run that pattern against the url
	var vastImg = result[0]; //set the result = vast123, the 0th index of the array that returns from the regex search
	//console.log(vastImg);
	//console.log(themap);
	//console.log(themap[vastImg]);
	if (directionFrom == "north"){
		var directionTo="south";
		if (imgarr[vastImg].includes("n")){ //check to make sure we can move in this direction on this plane
			if (typeof themap[vastImg]["n"] == 'undefined'){
				var newImgIndex = Math.floor(Math.random() * south.length) //generate a random index for the direction we wanna go
				var newImgName = south[newImgIndex]; //grip the name of that image
				var imgpath = rootContext + '/images/' + newImgName+ '.png' //grip the path to that image
				var image = new Image();
				image.src = imgpath;
				$('#plane').empty().append(image);
				var foo = {};
				var bar = {};
				foo[newImgName] = {"s":vastImg};
				bar[vastImg] = {"n":newImgName};
				return [foo,bar];
			} else {
				var newImgName = themap[vastImg]["n"];
				var imgpath = rootContext + '/images/' + newImgName + '.png';
				var image = new Image();
				image.src = imgpath;
				$('#plane').empty().append(image);
			}
		}
	} else if (directionFrom == "south"){
		var directionTo="north";
		if (imgarr[vastImg].includes("s")){
			if (typeof themap[vastImg]["s"] == 'undefined'){
				var newImgIndex = Math.floor(Math.random() * north.length)
				var newImgName = north[newImgIndex];
				var imgpath = rootContext + '/images/' + newImgName+ '.png'
				var image = new Image();
				image.src = imgpath;
				$('#plane').empty().append(image);
				var foo = {};
				var bar = {};
				foo[newImgName] = {"n":vastImg};
				bar[vastImg] = {"s":newImgName};
				return [foo,bar];
			} else {
				var newImgName = themap[vastImg]["s"];
				var imgpath = rootContext + '/images/' + newImgName + '.png';
				var image = new Image();
				image.src = imgpath;
				$('#plane').empty().append(image);
			}
		}
	} else if (directionFrom == "east"){
		var directionTo="west";
		if (imgarr[vastImg].includes("e")){
			if (typeof themap[vastImg]["e"] == 'undefined'){
				var newImgIndex = Math.floor(Math.random() * west.length)
				var newImgName = west[newImgIndex];
				var imgpath = rootContext + '/images/' + newImgName+ '.png'
				var image = new Image();
				image.src = imgpath;
				$('#plane').empty().append(image);
				var foo = {};
				var bar = {};
				foo[newImgName] = {"w":vastImg};
				bar[vastImg] = {"e":newImgName};
				return [foo,bar];
			} else {
				var newImgName = themap[vastImg]["e"];
				var imgpath = rootContext + '/images/' + newImgName + '.png';
				var image = new Image();
				image.src = imgpath;
				$('#plane').empty().append(image);
			}
		}
	} else if (directionFrom == "west"){
		var directionTo="east";
		if (imgarr[vastImg].includes("w")){
			if (typeof themap[vastImg]["w"] == 'undefined'){
				var newImgIndex = Math.floor(Math.random() * east.length)
				var newImgName = east[newImgIndex];
				var imgpath = rootContext + '/images/' + newImgName+ '.png'
				var image = new Image();
				image.src = imgpath;
				$('#plane').empty().append(image);
				var foo = {};
				var bar = {};
				foo[newImgName] = {"e":vastImg}
				bar[vastImg] = {"w":newImgName};
				return [foo,bar];
			} else {
				var newImgName = themap[vastImg]["w"];
				var imgpath = rootContext + '/images/' + newImgName + '.png';
				var image = new Image();
				image.src = imgpath;
				$('#plane').empty().append(image);
			}
		}
	}

}
</script>
<script>

</script>
</body>
</html>